import tensorflow as tf
import numpy as np
import matplotlib.pyplot as plt

#source data
ax = np.arange(0, 360)
#y = np.cos(t*(np.pi/180))

ay = 0.0
for i in range(1, 30, 2):
  ay += (np.sin(i*ax*(np.pi/180.0)) / i)
#placeholder
time_placeholder = tf.placeholder(tf.float32, [None])
value_placeholder = tf.placeholder(tf.float32, [None])

# change shape to [batch_size, 1]
time = tf.expand_dims(time_placeholder,axis=1)
value = tf.expand_dims(value_placeholder,axis=1)

#Full connect layer
output = time
for i in range(10):
  output = tf.layers.dense(output, 100, activation=tf.nn.tanh)
output = tf.nn.dropout(output, 0.2)
output = tf.layers.dense(output, 50, activation=tf.nn.tanh)
predict_value = tf.layers.dense(output, 1)

#loss function MAE
loss = tf.losses.absolute_difference(value, predict_value)

#minimize
optimizer = tf.train.AdamOptimizer(8e-5)
train_op = optimizer.minimize(loss)

with tf.Session() as sess:
    #init variables
    sess.run(tf.global_variables_initializer())
    
    #training 10000 times
    for epoch in range(10000):
        #y = ay + (0.1 * np.random.rand(360))
        indice = np.sort(np.random.choice(360, 100))
        x = ax[indice]
        y = ay[indice]

        output_time, output_value, output_predict, _ = sess.run(
                [time, value, predict_value, train_op],
                 feed_dict={time_placeholder: x, value_placeholder: y})
        
        #print it
        if epoch % 1000 == 0:
            plt.figure()
            plt.plot(output_time, output_value, 'o')
            plt.plot(output_time, output_predict, '-')
            plt.show()
